{% extends 'base.html.twig' %} {% block title %}Forum Dashboard{% endblock %} {% block body %}
<div class="container mx-auto px-4 py-16">
	<h1 class="text-3xl font-bold mb-6">Forum Management Dashboard</h1>

	<div class="bg-white rounded-lg shadow-md p-6 mb-8">
		<div class="flex justify-between items-center mb-4">
			<h2 class="text-xl font-semibold">All Forum Posts</h2>
			<span class="bg-blue-100 text-blue-800 text-xs font-medium py-1 px-2 rounded">{{ posts|length }} Posts</span>
		</div>

		<div id="postsContainer" class="mt-8">
			{% for post in posts %}
			<div id="post-{{ post.postId }}" class="mb-10 bg-white shadow rounded-lg p-6">
				<div class="mb-4">
					<div class="flex justify-between items-start">
						<span class="font-semibold text-gray-800 text-lg">{{ post.ownerName }}</span>
						<form
							hx-post="{{ path('app_forum_delete', {'id': post.postId}) }}"
							hx-target="#post-{{ post.postId }}"
							hx-swap="outerHTML"
							onsubmit="return confirm('Are you sure you want to delete this post?');"
							class="inline-block"
						>
							<button
								type="submit"
								class="p-2 w-10 h-10 bg-red-500 hover:bg-red-700 text-white rounded-full shadow transition-all cursor-pointer flex items-center justify-center"
								title="Delete post"
							>
								<i class="fa fa-trash"></i>
							</button>
						</form>
					</div>

					<div id="postText-{{ post.postId }}" class="mt-2 text-gray-700">{{ post.textContent }}</div>

					<div class="mt-2 text-sm text-gray-500">
						<span>Posted: {{ post.createdAt|date('M d, Y H:i') }}</span>
					</div>
				</div>

				<div class="mt-6">
					<h3 class="font-medium text-gray-700 mb-3">Comments ({{ post.comments|length }})</h3>
				</div>

				<div id="commentsContainer-{{ post.postId }}" class="mt-4">
					{% if post.comments is defined %} {% for comment in post.comments %}
					<div id="comment-{{ comment.commentId }}" class="mb-2 bg-gray-100 p-4 rounded-lg">
						<div class="flex justify-between items-start">
							<span class="font-semibold text-gray-800">{{ comment.commenterName }}</span>
							<form
								hx-post="{{ path('comment_delete', {'id': comment.commentId}) }}"
								hx-target="#comment-{{ comment.commentId }}"
								hx-swap="outerHTML"
								onsubmit="return confirm('Are you sure you want to delete this comment?');"
								class="inline-block"
							>
								<button
									type="submit"
									class="p-2 w-10 h-10 bg-red-500 hover:bg-red-700 text-white rounded-full shadow transition-all cursor-pointer flex items-center justify-center"
									title="Delete comment"
								>
									<i class="fa fa-trash"></i>
								</button>
							</form>
						</div>
						<div id="commentText-{{ comment.commentId }}" class="mt-1 text-gray-700">{{ comment.comment }}</div>
						<div class="text-xs text-gray-500 mt-1">{{ comment.commentedAt|date('M d, Y H:i') }}</div>
					</div>
					{% endfor %} {% endif %}
				</div>
			</div>
			{% else %}
			<div class="text-center py-8 text-gray-500">
				<p>No posts found in the forum.</p>
			</div>
			{% endfor %}
		</div>
	</div>
</div>

<script>
	document.body.addEventListener("htmx:afterSwap", function (event) {
		if (event.detail.target.id.startsWith("post-")) {
			const postElement = document.getElementById(event.detail.target.id);
			if (!postElement) {
				const countElement = document.querySelector(".text-blue-800");
				const currentCount = parseInt(countElement.textContent);
				if (!isNaN(currentCount)) {
					countElement.textContent = currentCount - 1 + " Posts";
				}
			}
		}
	});
</script>
{% endblock %}
