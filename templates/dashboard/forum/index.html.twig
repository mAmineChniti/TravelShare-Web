{% extends 'base.html.twig' %} {% block title %}Forum Dashboard{% endblock %} {% block body %}
<div class="container mx-auto px-4 mt-8 space-y-6">
	<h1 class="text-5xl font-bold mb-6">Forum Management Dashboard</h1>

	<div class="bg-white rounded-lg shadow-md p-6">
		<div class="flex justify-between items-center mb-4">
			<h2 class="text-3xl font-semibold">All Forum Posts</h2>
			<span class="text-gray-700">{{ posts|length }} Posts</span>
		</div>

		<div id="postsContainer" class="space-y-6">
			{% for post in posts %}
			<div id="post-{{ post.postId }}" class="bg-gray-100 rounded-lg p-4">
				<div class="flex justify-between items-center mb-2">
					<span class="text-blue-600 font-medium">{{ post.name ~ ' ' ~ post.lastName }}</span>
					<form
						hx-post="{{ path('app_forum_delete', {'id': post.postId}) }}"
						hx-target="#post-{{ post.postId }}"
						hx-swap="outerHTML"
						onsubmit="return confirm('Are you sure you want to delete this post?');"
						class=""
					>
						<button
							type="submit"
							class="bg-red-600 hover:bg-red-700 text-white font-medium py-1 px-3 rounded-lg"
							title="Delete post"
						>
							<i class="fas fa-trash"></i>
						</button>
					</form>
				</div>

				<div id="postText-{{ post.postId }}" class="text-gray-800 mb-2">{{ post.textContent }}</div>

				{% if post.images is defined and post.images|length > 0 %}
				<div class="grid grid-cols-3 gap-4 mb-4">
					{% for image in post.images %}
					<img src="data:image/jpeg;base64,{{ image }}" alt="Post Image" class="rounded-lg shadow-md" />
					{% endfor %}
				</div>
				{% endif %}

				<div class="text-sm text-gray-500">Posted: {{ post.createdAt|date('M d, Y H:i') }}</div>

				<div class="mt-4">
					<h3 class="text-lg font-semibold">Comments ({{ post.comments|length }})</h3>
				</div>

				<div id="commentsContainer-{{ post.postId }}" class="space-y-4">
					{% if post.comments is defined %} {% for comment in post.comments %}
					<div id="comment-{{ comment.commentId }}" class="bg-white rounded-lg p-3">
						<div class="flex justify-between items-center mb-2">
							<span class="text-blue-600 font-medium truncate">{{ comment.name ~ ' ' ~ comment.lastName }}</span>
							<form
								hx-post="{{ path('comment_delete', {'id': comment.commentId}) }}"
								hx-target="#comment-{{ comment.commentId }}"
								hx-swap="outerHTML"
								onsubmit="return confirm('Are you sure you want to delete this comment?');"
								class=""
							>
								<button
									type="submit"
									class="bg-red-600 hover:bg-red-700 text-white font-medium py-1 px-3 rounded-lg"
									title="Delete comment"
								>
									<i class="fas fa-trash"></i>
								</button>
							</form>
						</div>
						<div id="commentText-{{ comment.commentId }}" class="text-gray-800">{{ comment.comment }}</div>
						<div class="text-sm text-gray-500">{{ comment.commentedAt|date('M d, Y H:i') }}</div>
					</div>
					{% endfor %} {% endif %}
				</div>
			</div>
			{% else %}
			<div class="text-center text-gray-700">
				<p>No posts found in the forum.</p>
			</div>
			{% endfor %}
		</div>
	</div>
</div>

<script>
	document.body.addEventListener("htmx:afterSwap", function (event) {
		if (event.detail.target.id.startsWith("post-")) {
			const postElement = document.getElementById(event.detail.target.id);
			if (!postElement) {
				const countElement = document.querySelector(".text-gray-700");
				const currentCount = parseInt(countElement.textContent);
				if (!isNaN(currentCount)) {
					countElement.textContent = currentCount - 1 + " Posts";
				}
			}
		}
	});
</script>
{% endblock %}
