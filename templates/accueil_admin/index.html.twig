<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>{% block title %}Admin Dashboard{% endblock %}</title>
		<meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport" />

		<!-- Lien vers la favicon -->
		<link rel="icon" href="{{ asset('images2/favicon.svg') }}" type="image/x-icon" />
		<link rel="icon" href="{{ asset('images2/favicon.ico') }}" />

		{% block js %}
		<!-- Fonts and icons -->
		<script src="{{ asset('js2/plugin/webfont/webfont.min.js') }}"></script>
		<script>
			WebFont.load({
				google: { families: ["Public Sans:300,400,500,600,700"] },
				custom: {
					families: ["Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"],
					urls: ["css3/fonts.min.css"],
				},
				active: function () {
					sessionStorage.fonts = true;
				},
			});
		</script>
		{% endblock %} {% block css %}
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
		<!-- CSS Files -->
		<link rel="stylesheet" href="{{ asset('css3/bootstrap.min.css') }}" />
		<link rel="stylesheet" href="{{ asset('css3/plugins.min.css') }}" />
		<link rel="stylesheet" href="{{ asset('css3/kaiadmin.min.css') }}" />

		<!-- CSS Just for demo purpose, don't include it in your project -->
		<link rel="stylesheet" href="{{ asset('css3/demo.css') }}" />

		<style>
			/* assets/styles/admin.css */
			.table-hover tbody tr:hover {
				background-color: rgba(0, 0, 0, 0.02);
			}

			.avatar-initials {
				width: 40px;
				height: 40px;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: bold;
			}

			.btn-sm {
				padding: 0.25rem 0.5rem;
				font-size: 0.875rem;
			}

			.badge {
				font-size: 0.75em;
				font-weight: 500;
				padding: 0.35em 0.65em;
			}

			.bg-light-blue {
				background-color: #f8fafc;
			}
			.avatar-placeholder {
				font-weight: 600;
				font-size: 0.9rem;
			}
			.table-hover tbody tr:hover {
				background-color: rgba(0, 123, 255, 0.05) !important;
			}
			.badge {
				font-weight: 500;
				letter-spacing: 0.5px;
			}
		</style>
		{% endblock %}
	</head>

	{% block body%}

	<body>
		<div class="wrapper">
			<!-- Sidebar -->
			<div class="sidebar" data-background-color="dark">
				<div class="sidebar-logo">
					<!-- Logo Header -->
					<div class="logo-header" data-background-color="dark">
						<img src="{{ asset('images2/favicon.svg') }}" alt="navbar brand" class="navbar-brand" height="20" />
						<span class="ms-2 fs-5 text-primary">Admin Dashboard</span>
					</div>
					<!-- End Logo Header -->
				</div>

				<div class="sidebar-wrapper scrollbar scrollbar-inner">
					<div class="sidebar-content">
						<ul class="nav nav-secondary">
							<!-- Lien vers Dashboard -->
							<li class="nav-item active">
								<a href="{{ path('app_accueil_admin') }}">
									<i class="fas fa-home"></i>
									<p>Dashboard</p>
								</a>
							</li>

							<!-- Section séparée -->
							<li class="nav-section">
								<span class="sidebar-mini-icon">
									<i class="fa fa-ellipsis-h"></i>
								</span>
								<h4 class="text-section">Components</h4>
							</li>

							<!-- Lien vers Reclamation -->
							<li class="nav-item">
								<a href="{{ path('app_list_rec_admin') }}">
									<i class="fas fa-pen-square"></i>
									<p>Reclamation</p>
								</a>
							</li>
							<li class="nav-item">
								<a href="{{ path('app_guides_read') }}">
									<i class="fas fa-pen-square"></i>
									<p>Guides</p>
								</a>
							</li>
							<li class="nav-item">
								<a href="{{ path('app_excursions_read') }}">
									<i class="fas fa-pen-square"></i>
									<p>Excursions</p>
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!-- End Sidebar -->

			<div class="main-panel">
				<div class="main-header">
					<!-- Navbar Header -->
					<nav class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom">
						<div class="container-fluid">
							<nav class="navbar navbar-header-left navbar-expand-lg navbar-form nav-search p-0 d-none d-lg-flex">
								<div class="input-group">
									<div class="input-group-prepend">
										<button type="submit" class="btn btn-search pe-1">
											<i class="fa fa-search search-icon"></i>
										</button>
									</div>
									<input type="text" placeholder="Search ..." class="form-control" />
								</div>
							</nav>

							<ul class="navbar-nav topbar-nav ms-md-auto align-items-center">
								<li class="nav-item topbar-icon dropdown hidden-caret d-flex d-lg-none">
									<a
										class="nav-link dropdown-toggle"
										data-bs-toggle="dropdown"
										href="#"
										role="button"
										aria-expanded="false"
										aria-haspopup="true"
									>
										<i class="fa fa-search"></i>
									</a>
									<ul class="dropdown-menu dropdown-search animated fadeIn">
										<form class="navbar-left navbar-form nav-search">
											<div class="input-group">
												<input type="text" placeholder="Search ..." class="form-control" />
											</div>
										</form>
									</ul>
								</li>
								<li class="nav-item topbar-icon dropdown hidden-caret">
									<a
										class="nav-link dropdown-toggle"
										href="#"
										id="messageDropdown"
										role="button"
										data-bs-toggle="dropdown"
										aria-haspopup="true"
										aria-expanded="false"
									>
										<i class="fa fa-envelope"></i>
									</a>
									<ul class="dropdown-menu messages-notif-box animated fadeIn" aria-labelledby="messageDropdown">
										<li>
											<div class="dropdown-title d-flex justify-content-between align-items-center">
												Messages
												<a href="#" class="small">Mark all as read</a>
											</div>
										</li>
										<li>
											<div class="message-notif-scroll scrollbar-outer">
												<div class="notif-center">
													<a href="#">
														<div class="notif-img">
															<img src="assets/img/jm_denis.jpg" alt="Img Profile" />
														</div>
														<div class="notif-content">
															<span class="subject">Jimmy Denis</span>
															<span class="block"> How are you ? </span>
															<span class="time">5 minutes ago</span>
														</div>
													</a>
													<a href="#">
														<div class="notif-img">
															<img src="assets/img/chadengle.jpg" alt="Img Profile" />
														</div>
														<div class="notif-content">
															<span class="subject">Chad</span>
															<span class="block"> Ok, Thanks ! </span>
															<span class="time">12 minutes ago</span>
														</div>
													</a>
													<a href="#">
														<div class="notif-img">
															<img src="assets/img/mlane.jpg" alt="Img Profile" />
														</div>
														<div class="notif-content">
															<span class="subject">Jhon Doe</span>
															<span class="block"> Ready for the meeting today... </span>
															<span class="time">12 minutes ago</span>
														</div>
													</a>
													<a href="#">
														<div class="notif-img">
															<img src="assets/img/talha.jpg" alt="Img Profile" />
														</div>
														<div class="notif-content">
															<span class="subject">Talha</span>
															<span class="block"> Hi, Apa Kabar ? </span>
															<span class="time">17 minutes ago</span>
														</div>
													</a>
												</div>
											</div>
										</li>
										<li>
											<a class="see-all" href="javascript:void(0);"
												>See all messages<i class="fa fa-angle-right"></i>
											</a>
										</li>
									</ul>
								</li>
								<li class="nav-item topbar-icon dropdown hidden-caret">
									<a
										class="nav-link dropdown-toggle"
										href="#"
										id="notifDropdown"
										role="button"
										data-bs-toggle="dropdown"
										aria-haspopup="true"
										aria-expanded="false"
									>
										<i class="fa fa-bell"></i>
										<span class="notification">4</span>
									</a>
									<ul class="dropdown-menu notif-box animated fadeIn" aria-labelledby="notifDropdown">
										<li>
											<div class="dropdown-title">You have 4 new notification</div>
										</li>
										<li>
											<div class="notif-scroll scrollbar-outer">
												<div class="notif-center">
													<a href="#">
														<div class="notif-icon notif-primary">
															<i class="fa fa-user-plus"></i>
														</div>
														<div class="notif-content">
															<span class="block"> New user registered </span>
															<span class="time">5 minutes ago</span>
														</div>
													</a>
													<a href="#">
														<div class="notif-icon notif-success">
															<i class="fa fa-comment"></i>
														</div>
														<div class="notif-content">
															<span class="block"> Rahmad commented on Admin </span>
															<span class="time">12 minutes ago</span>
														</div>
													</a>
													<a href="#">
														<div class="notif-img">
															<img src="assets/img/profile2.jpg" alt="Img Profile" />
														</div>
														<div class="notif-content">
															<span class="block"> Reza send messages to you </span>
															<span class="time">12 minutes ago</span>
														</div>
													</a>
													<a href="#">
														<div class="notif-icon notif-danger">
															<i class="fa fa-heart"></i>
														</div>
														<div class="notif-content">
															<span class="block"> Farrah liked Admin </span>
															<span class="time">17 minutes ago</span>
														</div>
													</a>
												</div>
											</div>
										</li>
										<li>
											<a class="see-all" href="javascript:void(0);"
												>See all notifications<i class="fa fa-angle-right"></i>
											</a>
										</li>
									</ul>
								</li>
								<li class="nav-item topbar-icon dropdown hidden-caret">
									<a class="nav-link" data-bs-toggle="dropdown" href="#" aria-expanded="false">
										<i class="fas fa-layer-group"></i>
									</a>
									<div class="dropdown-menu quick-actions animated fadeIn">
										<div class="quick-actions-header">
											<span class="title mb-1">Quick Actions</span>
											<span class="subtitle op-7">Shortcuts</span>
										</div>
										<div class="quick-actions-scroll scrollbar-outer">
											<div class="quick-actions-items">
												<div class="row m-0">
													<a class="col-6 col-md-4 p-0" href="#">
														<div class="quick-actions-item">
															<div class="avatar-item bg-danger rounded-circle">
																<i class="far fa-calendar-alt"></i>
															</div>
															<span class="text">Calendar</span>
														</div>
													</a>
													<a class="col-6 col-md-4 p-0" href="#">
														<div class="quick-actions-item">
															<div class="avatar-item bg-warning rounded-circle">
																<i class="fas fa-map"></i>
															</div>
															<span class="text">Maps</span>
														</div>
													</a>
													<a class="col-6 col-md-4 p-0" href="#">
														<div class="quick-actions-item">
															<div class="avatar-item bg-info rounded-circle">
																<i class="fas fa-file-excel"></i>
															</div>
															<span class="text">Reports</span>
														</div>
													</a>
													<a class="col-6 col-md-4 p-0" href="#">
														<div class="quick-actions-item">
															<div class="avatar-item bg-success rounded-circle">
																<i class="fas fa-envelope"></i>
															</div>
															<span class="text">Emails</span>
														</div>
													</a>
													<a class="col-6 col-md-4 p-0" href="#">
														<div class="quick-actions-item">
															<div class="avatar-item bg-primary rounded-circle">
																<i class="fas fa-file-invoice-dollar"></i>
															</div>
															<span class="text">Invoice</span>
														</div>
													</a>
													<a class="col-6 col-md-4 p-0" href="#">
														<div class="quick-actions-item">
															<div class="avatar-item bg-secondary rounded-circle">
																<i class="fas fa-credit-card"></i>
															</div>
															<span class="text">Payments</span>
														</div>
													</a>
												</div>
											</div>
										</div>
									</div>
								</li>

								<li class="nav-item topbar-user dropdown hidden-caret">
									<a class="dropdown-toggle profile-pic" data-bs-toggle="dropdown" href="#" aria-expanded="false">
										<div class="avatar-sm">
											<img src="{{ asset('images2/profile.png') }}" alt="..." class="avatar-img rounded-circle" />
										</div>
										<span class="profile-username">
											<span class="op-7">Hi,</span>
											<span class="fw-bold">Hizrian</span>
										</span>
									</a>
									<ul class="dropdown-menu dropdown-user animated fadeIn">
										<div class="dropdown-user-scroll scrollbar-outer">
											<li>
												<div class="user-box">
													<div class="avatar-lg">
														<img
															src="{{ asset('images2/profile.png') }}"
															alt="image profile"
															class="avatar-img rounded"
														/>
													</div>
													<div class="u-text">
														<h4>Hizrian</h4>
														<p class="text-muted">hello@example.com</p>
														<a href="profile.html" class="btn btn-xs btn-secondary btn-sm">View Profile</a>
													</div>
												</div>
											</li>
											<li>
												<div class="dropdown-divider"></div>
												<a class="dropdown-item" href="#">My Profile</a>
												<div class="dropdown-divider"></div>
												<a class="dropdown-item" href="#">Account Setting</a>
												<div class="dropdown-divider"></div>
												<a class="dropdown-item" href="{{ path('app_logout') }}">Logout</a>
											</li>
										</div>
									</ul>
								</li>
							</ul>
						</div>
					</nav>
					<!-- End Navbar -->
				</div>

				<div class="container">
					<div class="page-inner">
						<div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
							<div>
								<h3 class="fw-bold mb-3">Dashboard</h3>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6 col-md-3">
								<div class="card card-stats card-round">
									<div class="card-body">
										<div class="row align-items-center">
											<div class="col-icon">
												<div class="icon-big text-center icon-primary bubble-shadow-small">
													<i class="fas fa-users"></i>
												</div>
											</div>
											<div class="col col-stats ms-3 ms-sm-0">
												<div class="numbers">
													<p class="card-category">Visitors</p>
													<h4 class="card-title">1,294</h4>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6 col-md-3">
								<div class="card card-stats card-round">
									<div class="card-body">
										<div class="row align-items-center">
											<div class="col-icon">
												<div class="icon-big text-center icon-info bubble-shadow-small">
													<i class="fas fa-user-check"></i>
												</div>
											</div>
											<div class="col col-stats ms-3 ms-sm-0">
												<div class="numbers">
													<p class="card-category">Subscribers</p>
													<h4 class="card-title">1303</h4>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6 col-md-3">
								<div class="card card-stats card-round">
									<div class="card-body">
										<div class="row align-items-center">
											<div class="col-icon">
												<div class="icon-big text-center icon-success bubble-shadow-small">
													<i class="fas fa-luggage-cart"></i>
												</div>
											</div>
											<div class="col col-stats ms-3 ms-sm-0">
												<div class="numbers">
													<p class="card-category">Sales</p>
													<h4 class="card-title">$ 1,345</h4>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6 col-md-3">
								<div class="card card-stats card-round">
									<div class="card-body">
										<div class="row align-items-center">
											<div class="col-icon">
												<div class="icon-big text-center icon-secondary bubble-shadow-small">
													<i class="far fa-check-circle"></i>
												</div>
											</div>
											<div class="col col-stats ms-3 ms-sm-0">
												<div class="numbers">
													<p class="card-category">Order</p>
													<h4 class="card-title">576</h4>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-12">
								<div class="card card-round">
									<div class="card-body">
										<div class="card-head-row card-tools-still-right">
											<h4 class="card-title text-primary"><i class="fas fa-users-cog me-2"></i>User Management</h4>
											<div class="card-tools">
												<div class="input-group">
													<input
														type="text"
														class="form-control border-primary"
														placeholder="Search users..."
														id="userSearch"
													/>
													<div class="input-group-append">
														<button class="btn btn-primary" type="button">
															<i class="fas fa-search"></i>
														</button>
													</div>
												</div>
											</div>
										</div>

										<div class="table-responsive mt-3">
											<table class="table table-hover table-striped">
												<thead class="bg-light-blue">
													<tr>
														<th class="text-center"><i class="fas fa-image"></i> Photo</th>
														<th><i class="fas fa-user me-1"></i> First Name</th>
														<th><i class="fas fa-user me-1"></i> Last Name</th>
														<th><i class="fas fa-envelope me-1"></i> Email</th>
														<th><i class="fas fa-phone me-1"></i> Phone</th>
														<th><i class="fas fa-map-marker-alt me-1"></i> Address</th>
														<th class="text-center"><i class="fas fa-circle-notch me-1"></i> Status</th>
														<th class="text-center"><i class="fas fa-cog"></i> Actions</th>
													</tr>
												</thead>
												<tbody>
													{% for user in users %}
													<tr class="align-middle">
														<td class="text-center">
															{% if user.photo %}
															<img
																src="{{ user.getPhotoBase64() }}"
																class="rounded-circle shadow-sm"
																width="40"
																height="40"
																alt="Profile"
																onerror="this.onerror=null;this.src='{{ asset('images/default-avatar.png') }}'"
															/>
															{% else %}
															<div
																class="avatar-placeholder rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center"
																style="width: 40px; height: 40px"
															>
																{{ user.name|first|upper }}{{ user.lastName|first|upper }}
															</div>
															{% endif %}
														</td>
														<td>{{ user.name }}</td>
														<td>{{ user.lastName }}</td>
														<td>{{ user.email }}</td>
														<td>{{ user.phoneNum }}</td>
														<td title="{{ user.address }}">
															{{ user.address|length > 20 ? user.address|slice(0, 20) ~ '...' : user.address }}
														</td>
														<td class="text-center">
															<span class="badge rounded-pill bg-{{ user.isBlocked() ? 'danger' : 'success' }}">
																<i class="fas fa-{{ user.isBlocked() ? 'lock' : 'check-circle' }} me-1"></i>
																{{ user.isBlocked() ? 'Bloqué' : 'Actif' }}
															</span>
														</td>
														<td class="text-center">
															<div class="btn-group" role="group">
																<form
																	method="POST"
																	action="{{ path('admin_user_toggle_block', {'id': user.userId}) }}"
																	class="d-inline toggle-block-form"
																	data-user-id="{{ user.userId }}"
																>
																	<input
																		type="hidden"
																		name="_token"
																		value="{{ csrf_token('toggle-block' ~ user.userId) }}"
																	/>
																	<button
																		type="submit"
																		class="btn btn-sm btn-{{ user.isBlocked() ? 'success' : 'danger' }} mx-1"
																		title="{{ user.isBlocked() ? 'Débloquer' : 'Bloquer' }}"
																	>
																		<i class="fas fa-{{ user.isBlocked() ? 'unlock' : 'ban' }}"></i>
																		{{ user.isBlocked() ? 'Débloquer' : 'Bloquer' }}
																	</button>
																</form>

																<a href="mailto:{{ user.email }}" class="btn btn-sm btn-info mx-1" title="Send Email">
																	<i class="fas fa-envelope"></i>
																</a>

																<button
																	class="btn btn-sm btn-warning mx-1 edit-user"
																	data-user-id="{{ user.userId }}"
																	title="Edit"
																>
																	<i class="fas fa-edit"></i>
																</button>
															</div>
														</td>
													</tr>
													{% endfor %}
												</tbody>
											</table>
										</div>

										<div class="d-flex justify-content-center mt-4">{{ knp_pagination_render(users) }}</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Custom template | don't include it in your project! -->
			<div class="custom-template">
				<div class="title">Settings</div>
				<div class="custom-content">
					<div class="switcher">
						<div class="switch-block">
							<h4>Logo Header</h4>
							<div class="btnSwitch">
								<button type="button" class="selected changeLogoHeaderColor" data-color="dark"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="blue"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="purple"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="light-blue"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="green"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="orange"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="red"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="white"></button>
								<br />
								<button type="button" class="changeLogoHeaderColor" data-color="dark2"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="blue2"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="purple2"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="light-blue2"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="green2"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="orange2"></button>
								<button type="button" class="changeLogoHeaderColor" data-color="red2"></button>
							</div>
						</div>
						<div class="switch-block">
							<h4>Navbar Header</h4>
							<div class="btnSwitch">
								<button type="button" class="changeTopBarColor" data-color="dark"></button>
								<button type="button" class="changeTopBarColor" data-color="blue"></button>
								<button type="button" class="changeTopBarColor" data-color="purple"></button>
								<button type="button" class="changeTopBarColor" data-color="light-blue"></button>
								<button type="button" class="changeTopBarColor" data-color="green"></button>
								<button type="button" class="changeTopBarColor" data-color="orange"></button>
								<button type="button" class="changeTopBarColor" data-color="red"></button>
								<button type="button" class="selected changeTopBarColor" data-color="white"></button>
								<br />
								<button type="button" class="changeTopBarColor" data-color="dark2"></button>
								<button type="button" class="changeTopBarColor" data-color="blue2"></button>
								<button type="button" class="changeTopBarColor" data-color="purple2"></button>
								<button type="button" class="changeTopBarColor" data-color="light-blue2"></button>
								<button type="button" class="changeTopBarColor" data-color="green2"></button>
								<button type="button" class="changeTopBarColor" data-color="orange2"></button>
								<button type="button" class="changeTopBarColor" data-color="red2"></button>
							</div>
						</div>
						<div class="switch-block">
							<h4>Sidebar</h4>
							<div class="btnSwitch">
								<button type="button" class="changeSideBarColor" data-color="white"></button>
								<button type="button" class="selected changeSideBarColor" data-color="dark"></button>
								<button type="button" class="changeSideBarColor" data-color="dark2"></button>
							</div>
						</div>
					</div>
				</div>
				<div class="custom-toggle">
					<i class="icon-settings"></i>
				</div>
			</div>
			<!-- End Custom template -->
		</div>

		{% endblock %} {% block js2 %}
		<!--   Core JS Files   -->
		<script src="{{ asset('js2/core/jquery-3.7.1.min.js') }}"></script>
		<script src="{{ asset('js2/core/popper.min.js') }}"></script>
		<script src="{{ asset('js2/core/bootstrap.min.js') }}"></script>

		<!-- jQuery Scrollbar -->
		<script src="{{ asset('js2/plugin/jquery-scrollbar/jquery.scrollbar.min.js') }}"></script>

		<!-- Chart JS -->
		<script src="{{ asset('js2/plugin/chart.js/chart.min.js') }}"></script>

		<!-- jQuery Sparkline -->
		<script src="{{ asset('js2/plugin/jquery.sparkline/jquery.sparkline.min.js') }}"></script>

		<!-- Chart Circle -->
		<script src="{{ asset('js2/plugin/chart-circle/circles.min.js') }}"></script>

		<!-- Datatables -->
		<script src="{{ asset('js2/plugin/datatables/datatables.min.js') }}"></script>

		<!-- Bootstrap Notify -->
		<script src="{{ asset('js2/plugin/bootstrap-notify/bootstrap-notify.min.js') }}"></script>

		<!-- jQuery Vector Maps -->
		<script src="{{ asset('js2/plugin/jsvectormap/jsvectormap.min.js') }}"></script>
		<script src="{{ asset('js2/plugin/jsvectormap/world.js') }}"></script>

		<!-- Sweet Alert -->
		<script src="{{ asset('js2/plugin/sweetalert/sweetalert.min.js') }}"></script>

		<!-- Kaiadmin JS -->
		<script src="{{ asset('js2/kaiadmin.min.js') }}"></script>

		<!-- Kaiadmin DEMO methods, don't include it in your project! -->
		<script src="{{ asset('js2/setting-demo.js') }}"></script>
		<script src="{{ asset('js2/demo.js') }}"></script>

		<script>
			$("#lineChart").sparkline([102, 109, 120, 99, 110, 105, 115], {
				type: "line",
				height: "70",
				width: "100%",
				lineWidth: "2",
				lineColor: "#177dff",
				fillColor: "rgba(23, 125, 255, 0.14)",
			});

			$("#lineChart2").sparkline([99, 125, 122, 105, 110, 124, 115], {
				type: "line",
				height: "70",
				width: "100%",
				lineWidth: "2",
				lineColor: "#f3545d",
				fillColor: "rgba(243, 84, 93, .14)",
			});

			$("#lineChart3").sparkline([105, 103, 123, 100, 95, 105, 115], {
				type: "line",
				height: "70",
				width: "100%",
				lineWidth: "2",
				lineColor: "#ffa534",
				fillColor: "rgba(255, 165, 52, .14)",
			});

			//userbloc
			document.querySelectorAll(".toggle-block").forEach((button) => {
				button.addEventListener("click", async function () {
					const userId = this.dataset.userId;

					try {
						const response = await fetch(`/admin/user/toggle-block/${userId}`, {
							method: "POST",
							headers: {
								"X-Requested-With": "XMLHttpRequest",
								"Content-Type": "application/json",
							},
						});

						const result = await response.json();

						if (result.success) {
							// Mise à jour immédiate de l'interface
							this.innerHTML = `<i class="fas fa-${result.isBlocked ? "unlock" : "ban"}"></i> ${result.newButtonText}`;
							this.className = `btn btn-sm btn-${result.isBlocked ? "success" : "danger"} toggle-block`;
							this.title = result.isBlocked ? "Débloquer" : "Bloquer";

							// Mise à jour du statut
							const statusBadge = this.closest("tr").querySelector(".badge");
							statusBadge.className = `badge rounded-pill bg-${result.isBlocked ? "danger" : "success"}`;
							statusBadge.innerHTML = `<i class="fas fa-${result.isBlocked ? "lock" : "check-circle"} me-1"></i> ${result.newStatusText}`;

							alert(result.message); // Remplacer par un système de notification plus élégant
						}
					} catch (error) {
						console.error("Erreur:", error);
						alert("Une erreur est survenue");
					}
				});
			});

			//toggle

			document.querySelectorAll(".toggle-block-form").forEach((form) => {
				form.addEventListener("submit", function (event) {
					event.preventDefault(); // Empêche le formulaire de se soumettre de manière classique

					let userId = this.getAttribute("data-user-id"); // Récupère l'ID de l'utilisateur
					let button = this.querySelector("button"); // Le bouton de blocage/déblocage
					let statusSpan = this.closest("tr").querySelector(".badge"); // Le badge de statut de l'utilisateur

					// Envoi de la requête AJAX avec Fetch
					fetch(this.action, {
						method: "POST",
						headers: {
							"Content-Type": "application/x-www-form-urlencoded",
							"X-Requested-With": "XMLHttpRequest",
							"X-CSRF-TOKEN": this.querySelector('input[name="_token"]').value, // Token CSRF
						},
						body: new URLSearchParams(new FormData(this)),
					})
						.then((response) => response.json())
						.then((data) => {
							if (data.success) {
								// Mise à jour du texte du bouton et du badge en fonction de l'état de l'utilisateur
								if (data.isBlocked) {
									statusSpan.textContent = "Bloqué";
									statusSpan.className = "badge rounded-pill bg-danger";
									button.innerHTML = '<i class="fas fa-ban"></i> Bloquer';
									button.classList.remove("btn-success");
									button.classList.add("btn-danger");
								} else {
									statusSpan.textContent = "Actif";
									statusSpan.className = "badge rounded-pill bg-success";
									button.innerHTML = '<i class="fas fa-unlock"></i> Débloquer';
									button.classList.remove("btn-danger");
									button.classList.add("btn-success");
								}
							} else {
								alert("Erreur lors du changement de statut de l'utilisateur.");
							}
						})
						.catch((error) => {
							console.error("Erreur:", error);
							alert("Une erreur est survenue lors de la mise à jour de l'utilisateur.");
						});
				});
			});
		</script>
		{% endblock %}
	</body>
</html>
