{% extends 'base.html.twig' %} {% block title %}Hotels{% endblock %} {% block body %} {% set categories = { 'Hotel
Rating': ['2 Stars', '3 Stars', '4 Stars', '5 Stars', 'Boutique Hotel', 'Luxury Resort'], 'Location Type':
['Beachfront', 'City Center', 'Countryside', 'Mountain Area', 'Forest Nearby', 'Island'], 'Experience Theme': ['Spa &
Wellness', 'Adventure & Activities', 'Romantic Getaway', 'Family-Friendly', 'Eco-Friendly', 'Business Hotel'], 'Price
Range': ['Budget-Friendly', 'Mid-Range', 'Premium', 'Luxury', 'All-Inclusive'] } %}

<div class="container mx-auto px-4 mt-8 space-y-6">
	<h1 class="text-5xl font-bold mb-6">Hotels</h1>
	<div class="flex">
		<!-- Sidebar for filtering -->
		<aside class="w-1/4 pr-4 relative">
			<form method="get" class="space-y-4 bg-white shadow-lg rounded-lg p-6 sticky top-4">
				<h2 class="text-xl font-semibold mb-4">Filter by Features</h2>
				<div class="space-y-6">
					{% for category, features in categories %}
					<div>
						<h3 class="text-lg font-semibold">{{ category }}</h3>
						<div class="space-y-3 mt-2">
							{% for feature in features %}
							<label class="flex items-center space-x-3">
								<input
									type="checkbox"
									name="description[]"
									value="{{ feature }}"
									{%
									if
									feature
									in
									filterDescriptions
									%}checked{%
									endif
									%}
									class="form-checkbox h-5 w-5 text-blue-600 focus:ring focus:ring-blue-300"
								/>
								<span class="text-gray-700">{{ feature }}</span>
							</label>
							{% endfor %}
						</div>
					</div>
					{% endfor %}
				</div>
				<button
					type="submit"
					class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow w-full mt-4"
				>
					Apply Filters
				</button>
			</form>
		</aside>

		<!-- Main content for hotels -->
		<main class="w-3/4 ml-6">
			<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
				{% for hotel in hotels %}
				<div class="bg-white rounded-lg shadow-md p-6 transform transition duration-300 hover:scale-105">
					<div class="mb-4">
						{% if hotel.imageH %}
						<img
							src="data:image/jpeg;base64,{{ hotel.base64Image }}"
							alt="{{ hotel.nom }}"
							class="w-full h-48 object-cover rounded-lg"
						/>
						{% else %}
						<span class="block text-center text-gray-500">No Image Available</span>
						{% endif %}
					</div>
					<div class="space-y-2">
						<h2 class="text-3xl font-semibold">{{ hotel.nom }}</h2>
						<p class="text-base text-gray-700"><strong>Address:</strong> {{ hotel.adress }}</p>
						<p class="text-base text-gray-700"><strong>Phone:</strong> {{ hotel.telephone }}</p>
						<p class="text-base text-gray-700"><strong>Capacity:</strong> {{ hotel.capaciteTotale }} guests</p>
						<p class="text-base text-gray-700"><strong>Description:</strong> {{ hotel.description }}</p>
					</div>
					<div class="mt-4 flex space-x-2 items-center">
						<a
							href="{{ path('hotel_rooms', { hotelId: hotel.id }) }}"
							class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow"
						>
							View Available Rooms
						</a>
						<!-- Share Button -->
						<button
							type="button"
							class="share-btn bg-gray-200 hover:bg-gray-300 text-gray-800 p-2 rounded-full focus:outline-none"
							data-url="{{ app.request.scheme ~ '://' ~ app.request.httpHost ~ path('hotel_rooms', { hotelId: hotel.id }) }}"
							data-title="{{ hotel.nom }}"
							aria-label="Share {{ hotel.nom }}"
						>
							<svg
								xmlns="http://www.w3.org/2000/svg"
								class="h-5 w-5"
								fill="none"
								viewBox="0 0 24 24"
								stroke="currentColor"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M8 12l8-4m0 0l-8-4m8 4v8m-8-4h8"
								/>
							</svg>
						</button>
					</div>
				</div>
				{% endfor %}
			</div>
		</main>
	</div>

<div class="mt-8">
    <h2 class="text-2xl font-semibold mb-6">AI Recommended Highlights</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {% if recommendation %}
            {% set recommendations = recommendation|split('/\d+\.\s*/')|filter(v => v is not empty) %}
            {% for rec in recommendations|slice(0, 3) %}
                <div class="bg-white rounded-lg shadow-md p-6 transform transition duration-300 hover:scale-[1.02]">
                    <div class="flex items-center mb-4">
                        <div class="h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold">Top Pick #{{ loop.index }}</h3>
                    </div>
                    {% set cleaned_rec = rec|trim|replace({' - ': ': ', ':': ': '}) %}
                    {% set parts = cleaned_rec|split(': ', 2) %}
                    {% if parts|length > 1 %}
                        <p class="font-medium text-gray-900 mb-2">{{ parts[0]|trim }}</p>
                        <p class="text-gray-700">{{ parts[1]|trim|trim('.', 'right') }}</p>
                    {% else %}
                        {% set parts = cleaned_rec|split('. ', 2) %}
                        <p class="font-medium text-gray-900 mb-2">{{ parts[0]|trim }}</p>
                        <p class="text-gray-700">{{ parts[1:]|join('. ')|trim }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            {% for i in 1..3 %}
                <div class="bg-gray-100 rounded-lg p-6 animate-pulse">
                    <div class="h-4 bg-gray-300 rounded w-3/4 mb-4"></div>
                    <div class="space-y-2">
                        <div class="h-3 bg-gray-300 rounded w-full"></div>
                        <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-3 bg-gray-300 rounded w-4/6"></div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>

	{# Share Modal (inline) #}
	<div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
		<div class="bg-white rounded-lg shadow-lg p-6 w-11/12 max-w-sm">
			<h3 class="text-xl font-semibold mb-4">Share this hotel</h3>
			<div class="space-y-3">
				<button id="copy-link" class="w-full text-left py-2 border rounded hover:bg-gray-100">Copy Link</button>
				<a id="share-email" href="#" class="block py-2 border rounded hover:bg-gray-100">Share via Email</a>
				<a id="share-whatsapp" href="#" target="_blank" class="block py-2 border rounded hover:bg-gray-100"
					>Share on WhatsApp</a
				>
				<a id="share-facebook" href="#" target="_blank" class="block py-2 border rounded hover:bg-gray-100"
					>Share on Facebook</a
				>
			</div>
			<button id="close-share" class="mt-4 text-sm text-gray-500 hover:underline">Close</button>
		</div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const modal = document.getElementById("share-modal");
			const buttons = document.querySelectorAll(".share-btn");
			const copyBtn = document.getElementById("copy-link");
			const emailEl = document.getElementById("share-email");
			const waEl = document.getElementById("share-whatsapp");
			const fbEl = document.getElementById("share-facebook");
			const closeEl = document.getElementById("close-share");

			const show = () => modal.classList.remove("hidden");
			const hide = () => modal.classList.add("hidden");

			buttons.forEach((btn) => {
				btn.addEventListener("click", async () => {
					const url = btn.dataset.url;
					const title = btn.dataset.title;

					if (navigator.share) {
						try {
							await navigator.share({ title, url });
							return;
						} catch {} // fallback to modal
					}

					copyBtn.onclick = () => {
						navigator.clipboard
							.writeText(url)
							.then(() => alert("Link copied!"))
							.catch(() => prompt("Copy this link", url));
					};

					emailEl.href = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(url)}`;
					waEl.href = `https://api.whatsapp.com/send?text=${encodeURIComponent(title + " " + url)}`;
					fbEl.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;

					closeEl.onclick = hide;
					modal.onclick = (e) => {
						if (e.target === modal) hide();
					};

					show();
				});
			});
		});
	</script>
	{% endblock %}
