{% extends 'base.html.twig' %} {% block title %}Forum{% endblock %} {% block body %}
<style>
	#imagePreviewContainer img {
		width: 50px;
		height: 50px;
		object-fit: cover;
		border-radius: 4px;
	}
	#imagePreviewContainer button {
		width: 16px;
		height: 16px;
		font-size: 10px;
	}
	#dropzone.dragover {
		background-color: rgba(0, 123, 255, 0.1);
		border-color: #007bff;
		transition:
			background-color 0.3s ease,
			border-color 0.3s ease;
	}
	#dropzone.dragover p {
		color: #007bff;
		font-weight: bold;
	}
</style>
<div class="container mx-auto px-4 mt-8 space-y-6">
    <form id="postForm" hx-encoding="multipart/form-data" class="bg-white rounded-lg shadow-md p-6 space-y-4">
        <div>
            <label for="postTitle" class="block text-sm font-medium text-gray-700">Title</label>
            <input
                type="text"
                name="postTitle"
                id="postTitle"
                class="block w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Enter a title for your post"
                maxlength="255"
            />
        </div>
        <div>
            <label for="postText" class="block text-sm font-medium text-gray-700">Post Content</label>
            <textarea
                name="postText"
                id="postText"
                class="block w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500 resize-none"
                placeholder="Write a postâ€¦"
                maxlength="255"
            ></textarea>
            <span id="postLength" class="text-sm text-gray-500">0/255</span>
        </div>
        <div>
            <label for="postImages" class="block mb-2 text-sm font-medium text-gray-700">Upload Images</label>
            <div class="flex items-center justify-center w-full">
                <label for="postImages" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                        </svg>
                        <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">SVG, PNG, JPG or GIF (MAX. 800x400px)</p>
                    </div>
                    <input id="postImages" type="file" class="hidden" name="postImages[]" multiple accept="image/*" />
                </label>
            </div>
            <div id="imagePreviewContainer" class="mt-4 flex flex-wrap gap-4"></div>
        </div>
        <p id="postErrorMessage" class="mt-1 text-sm text-red-600"></p>
        <div>
            <button
                type="button"
                onclick="ForumApp.submitPostIfValid()"
                class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow"
            >
                Post
            </button>
        </div>
    </form>
    <div class="flex items-center space-x-4 mb-6">
        <form id="search-form" method="get" action="{{ path('app_forum_search') }}" class="flex-grow">
            <input
                id="search-input"
                type="text"
                name="q"
                placeholder="Search posts..."
                value="{{ app.request.query.get('q', '') }}"
                class="w-full px-4 py-2 border-gray-300 rounded-full focus:ring-blue-600 focus:border-blue-600"
            />
        </form>
        <form id="sort-form" method="get" action="{{ path('app_forum_sort') }}">
            <select
                id="sort-select"
                name="sortBy"
                class="w-40 px-4 py-2 border-gray-300 rounded-full focus:ring-blue-600 focus:border-blue-600"
            >
                <option value="">Sort by</option>
                <option value="date_asc" {% if app.request.query.get('sortBy') == 'date_asc' %} selected {% endif %}>Date: Oldest First</option>
                <option value="date_desc" {% if app.request.query.get('sortBy') == 'date_desc' %} selected {% endif %}>Date: Newest First</option>
                <option value="hot" {% if app.request.query.get('sortBy') == 'hot' %} selected {% endif %}>Hot</option>
            </select>
        </form>
    </div>
    <div class="container mx-auto px-4 mt-8 space-y-6">
        {% if recommendedPosts is defined and recommendedPosts|length > 0 %}
        <div class="bg-gray-100 p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold text-blue-600 border-b border-blue-300 pb-2 mb-4">Recommended Posts</h2>
            <div class="space-y-6">
                {% for post in recommendedPosts %}
                <twig:Post
                post="{{ post }}"
                likesCount="{{ post.likesCount }}"
                dislikesCount="{{ post.dislikesCount }}"
                isLiked="{{ post.isLiked }}"
            />
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold text-gray-800 border-b border-gray-300 pb-2 mb-4">All Posts</h2>
            {% if posts is empty %}
            <p class="text-sm text-gray-500">No posts available.</p>
            {% endif %}
            <div id="postsContainer" class="space-y-6">
            {% if posts is defined and posts|length > 0 %}
                {% for post in posts %}
				<twig:Post
					post="{{ post }}"
					likesCount="{{ post.likesCount }}"
					dislikesCount="{{ post.dislikesCount }}"
					isLiked="{{ post.isLiked }}"/>
                {% endfor %}
            {% endif %}
            </div>
        </div>
    </div>
</div>

<div id="error-messages" class="mt-4">
	{% if errors is defined and errors|length > 0 %} {% for error in errors %}
	<p class="text-sm text-red-600">{{ error }}</p>
	{% endfor %} {% endif %}
</div>
<div id="success-messages" class="mt-4">
	{% if success is defined and success|length > 0 %} {% for message in success %}
	<p class="text-sm text-green-600">{{ message }}</p>
	{% endfor %} {% endif %}
</div>
{% endblock %}